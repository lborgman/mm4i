<html>

<head>
    <style>
        :root {
            box-sizing: border-box;
        }
    </style>
    <script src="./init-error.js"></script>
</head>

<body>
    <script type="module">
        const eltIframe = window.frameElement;
        if (!eltIframe) throw Error("Button is not in an <iframe>");
        const m = await import("./js/mod/supabase-sign-in.js");
        const b = await m.mkSignInButton(100);
        window.addEventListener("message", async (event) => {
            if (event.origin !== window.location.origin) return;
            if (event.data.type === "get_token") {
                const { data: { session } } = await supabase.auth.getSession();
                event.source.postMessage(
                    { type: "token", token: session?.access_token ?? null },
                    window.location.origin
                );
            }
        });
    </script>
</body>

</html>